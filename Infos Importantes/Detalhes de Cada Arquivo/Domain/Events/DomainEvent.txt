=========================================================
DOMAINEVENT.CS - DOCUMENTAÃ‡ÃƒO TÃ‰CNICA
=========================================================

VISÃƒO GERAL:
-----------
Classe base abstrata para todos os eventos de domÃ­nio no sistema.
Implementa o padrÃ£o Domain Events de Eric Evans (DDD) para comunicaÃ§Ã£o
entre agregados e bounded contexts sem acoplamento direto.
Integra com MediatR para dispatch e handling de eventos.

LOCALIZAÃ‡ÃƒO:
-----------
ğŸ“ AuthTenant.Domain/Events/DomainEvent.cs

DEPENDÃŠNCIAS:
------------
âœ… MediatR.INotification - Interface para notificaÃ§Ãµes assÃ­ncronas
âœ… System.ComponentModel.DataAnnotations - ValidaÃ§Ãµes de atributos
âœ… System.Text.Json - SerializaÃ§Ã£o de metadados

RESPONSABILIDADES:
-----------------
ğŸ”¸ Base para todos os eventos de domÃ­nio do sistema
ğŸ”¸ PadronizaÃ§Ã£o de propriedades comuns (Id, Timestamp, Tenant)
ğŸ”¸ IntegraÃ§Ã£o com pipeline de notificaÃ§Ãµes MediatR
ğŸ”¸ Suporte a multi-tenancy e rastreabilidade
ğŸ”¸ Versionamento e evoluÃ§Ã£o de esquemas de eventos
ğŸ”¸ Metadados extensÃ­veis para contexto adicional

PROPRIEDADES PRINCIPAIS:
-----------------------

1. IDENTIFICAÃ‡ÃƒO ÃšNICA:
   âœ… Id (Guid) - Identificador Ãºnico do evento
   âœ… EventType (string) - Nome da classe do evento
   âœ… EventNamespace (string) - Namespace para categorizaÃ§Ã£o
   âœ… Rastreabilidade completa de eventos

2. TIMESTAMP E AUDITORIA:
   âœ… OccurredOn (DateTime) - Timestamp UTC de ocorrÃªncia
   âœ… Version (int) - VersÃ£o do esquema do evento
   âœ… Controle temporal e versionamento

3. MULTI-TENANCY:
   âœ… TenantId (string) - Identificador do inquilino
   âœ… UserId (string?) - UsuÃ¡rio que causou o evento
   âœ… Isolamento e rastreamento por tenant

4. RASTREABILIDADE DISTRIBUÃDA:
   âœ… CorrelationId (Guid?) - ID de correlaÃ§Ã£o para distributed tracing
   âœ… Metadata (string?) - Metadados JSON extensÃ­veis
   âœ… Observabilidade e debugging de fluxos

PROPRIEDADES COMPUTADAS:
------------------------

ğŸ”§ EventType
   - Nome da classe do evento automaticamente
   - Usado para roteamento e identificaÃ§Ã£o
   - Exemplo: "ProductCreatedEvent", "UserRegisteredEvent"

ğŸ”§ EventNamespace
   - Namespace completo da classe
   - CategorizaÃ§Ã£o e filtragem de eventos
   - Exemplo: "AuthTenant.Domain.Events"

MÃ‰TODOS PRINCIPAIS:
------------------

ğŸ”§ IsValid() : bool
   - ValidaÃ§Ã£o bÃ¡sica de consistÃªncia do evento
   - Verifica propriedades obrigatÃ³rias
   - TenantId nÃ£o-vazio, OccurredOn vÃ¡lido, Version > 0
   - Override permitido para validaÃ§Ãµes especÃ­ficas

ğŸ”§ WithCorrelationId(Guid newCorrelationId) : DomainEvent (abstract)
   - Cria nova instÃ¢ncia com Correlation ID atualizado
   - PadrÃ£o immutable para events
   - ImplementaÃ§Ã£o especÃ­fica em cada evento
   - Suporte a distributed tracing

ğŸ”§ WithMetadata(string additionalMetadata) : DomainEvent (abstract)
   - Adiciona metadados ao evento
   - Merge inteligente de JSON
   - Extensibilidade sem quebrar contratos
   - Enriquecimento de contexto

ğŸ”§ ToString() : string (override)
   - RepresentaÃ§Ã£o estruturada para logging
   - Inclui informaÃ§Ãµes essenciais de debugging
   - Formato: "EventType [Id: ..., TenantId: ..., OccurredOn: ...]"
   - Facilita troubleshooting e auditoria

VALIDAÃ‡Ã•ES DE NEGÃ“CIO:
---------------------

1. PROPRIEDADES OBRIGATÃ“RIAS:
   âŒ TenantId nÃ£o pode ser nulo ou vazio
   âŒ Id deve ser GUID vÃ¡lido (gerado automaticamente)
   âŒ OccurredOn nÃ£o pode ser no futuro
   âŒ Version deve ser maior que zero

2. LIMITES DE DADOS:
   âŒ TenantId: 1-50 caracteres
   âŒ UserId: mÃ¡ximo 50 caracteres
   âŒ Metadata: mÃ¡ximo 2000 caracteres JSON
   âŒ Valores razoÃ¡veis para performance

3. FORMATO E CONSISTÃŠNCIA:
   âŒ Metadata deve ser JSON vÃ¡lido se fornecido
   âŒ CorrelationId deve ser GUID vÃ¡lido se fornecido
   âŒ OccurredOn sempre em UTC
   âŒ ConsistÃªncia temporal com tolerÃ¢ncia

FUNCIONALIDADES AVANÃ‡ADAS:
--------------------------

ğŸš€ VERSIONAMENTO DE EVENTOS:
   - Campo Version para evoluÃ§Ã£o de esquemas
   - Compatibilidade com versÃµes anteriores
   - MigraÃ§Ã£o gradual de estruturas
   - Suporte a deployment blue-green

ğŸš€ DISTRIBUTED TRACING:
   - CorrelationId para rastreamento distribuÃ­do
   - IntegraÃ§Ã£o com APM tools
   - Debugging de fluxos complexos
   - Observabilidade end-to-end

ğŸš€ METADADOS EXTENSÃVEIS:
   - Campo JSON para contexto adicional
   - Extensibilidade sem breaking changes
   - Enriquecimento por middlewares
   - Flexibilidade de evoluÃ§Ã£o

ğŸš€ MULTI-TENANT ISOLATION:
   - TenantId obrigatÃ³rio em todos os eventos
   - Isolamento automÃ¡tico de processamento
   - Filtragem por tenant
   - Compliance e seguranÃ§a

PADRÃ•ES ARQUITETURAIS:
---------------------

ğŸ—ï¸ Domain Events (DDD) - ComunicaÃ§Ã£o entre agregados
ğŸ—ï¸ Observer Pattern - NotificaÃ§Ã£o de mudanÃ§as
ğŸ—ï¸ Mediator Pattern - Desacoplamento via MediatR
ğŸ—ï¸ Template Method - Base para eventos especÃ­ficos
ğŸ—ï¸ Immutable Objects - Records imutÃ¡veis
ğŸ—ï¸ Event Sourcing Ready - Estrutura para ES

INTEGRAÃ‡ÃƒO COM SISTEMA:
----------------------

ğŸ”— MediatR Pipeline - Dispatch e handling automÃ¡tico
ğŸ”— Event Handlers - Processamento assÃ­ncrono
ğŸ”— Event Store - PersistÃªncia de eventos (futuro)
ğŸ”— Message Bus - IntegraÃ§Ã£o entre bounded contexts
ğŸ”— Audit Log - Rastreamento de mudanÃ§as
ğŸ”— Analytics - MÃ©tricas de negÃ³cio

CENÃRIOS DE USO:
---------------

âœ… ComunicaÃ§Ã£o entre agregados do mesmo bounded context
âœ… NotificaÃ§Ã£o de mudanÃ§as para outros bounded contexts
âœ… Trigger de processos assÃ­ncronos (emails, integraÃ§Ãµes)
âœ… Auditoria e compliance de mudanÃ§as
âœ… Analytics e mÃ©tricas de negÃ³cio
âœ… Eventual consistency entre agregados
âœ… Saga orchestration e choreography
âœ… Event sourcing e CQRS

PERFORMANCE E ESCALABILIDADE:
----------------------------

âš¡ Records imutÃ¡veis para performance
âš¡ SerializaÃ§Ã£o otimizada para JSON
âš¡ Dispatch assÃ­ncrono via MediatR
âš¡ Batching de eventos para throughput
âš¡ Lazy evaluation de propriedades computadas
âš¡ Memory efficient com value semantics

SEGURANÃ‡A E COMPLIANCE:
----------------------

ğŸ”’ Isolamento por tenant obrigatÃ³rio
ğŸ”’ Auditoria completa de eventos
ğŸ”’ Imutabilidade para integridade
ğŸ”’ Rastreabilidade de usuÃ¡rios
ğŸ”’ Metadados para contexto de seguranÃ§a
ğŸ”’ Versionamento para compliance

OBSERVABILIDADE:
---------------

ğŸ“Š Structured logging com ToString()
ğŸ“Š Correlation ID para distributed tracing
ğŸ“Š MÃ©tricas de dispatch e processing
ğŸ“Š Health checks de event handlers
ğŸ“Š Alertas de eventos crÃ­ticos
ğŸ“Š Debugging facilitado com metadados

EXEMPLO DE USO:
--------------

```csharp
// Evento personalizado herdando de DomainEvent
public record ProductPriceChangedEvent : DomainEvent
{
    public string ProductId { get; init; }
    public decimal OldPrice { get; init; }
    public decimal NewPrice { get; init; }
    public string Reason { get; init; }

    public ProductPriceChangedEvent(
        string productId, 
        decimal oldPrice, 
        decimal newPrice, 
        string reason,
        string tenantId, 
        string? userId = null) : this()
    {
        ProductId = productId;
        OldPrice = oldPrice;
        NewPrice = newPrice;
        Reason = reason;
        TenantId = tenantId;
        UserId = userId;
    }

    private ProductPriceChangedEvent() { }

    public override DomainEvent WithCorrelationId(Guid newCorrelationId)
        => this with { CorrelationId = newCorrelationId };

    public override DomainEvent WithMetadata(string additionalMetadata)
        => this with { Metadata = CombineMetadata(Metadata, additionalMetadata) };
}

// Uso em agregado
public class Product : BaseEntity
{
    public void UpdatePrice(decimal newPrice, string reason, string updatedBy)
    {
        var oldPrice = Price;
        Price = newPrice;
        
        // Adiciona evento de domÃ­nio
        AddDomainEvent(new ProductPriceChangedEvent(
            Id, oldPrice, newPrice, reason, TenantId, updatedBy));
    }
}

// Handler do evento
public class ProductPriceChangedHandler : INotificationHandler<ProductPriceChangedEvent>
{
    public async Task Handle(ProductPriceChangedEvent notification, CancellationToken ct)
    {
        // Atualizar cache de preÃ§os
        // Notificar sistema de pricing
        // Enviar email para admin se mudanÃ§a > 20%
        // Atualizar analytics
    }
}
```

EXTENSÃ•ES FUTURAS:
-----------------

ğŸ”® Event Sourcing - Store completo de eventos
ğŸ”® Event Replay - Replay para debugging/testing
ğŸ”® Event Subscriptions - Webhooks para externos
ğŸ”® Event Streaming - Real-time processing
ğŸ”® Event Schemas - ValidaÃ§Ã£o automÃ¡tica de schemas
ğŸ”® Event Encryption - Criptografia de eventos sensÃ­veis

ANTI-PATTERNS A EVITAR:
-----------------------

âŒ Eventos sÃ­ncronos que causam coupling
âŒ Eventos com side effects no constructor
âŒ Eventos mutÃ¡veis que quebram integridade
âŒ Eventos sem TenantId em sistema multi-tenant
âŒ Eventos gigantes com toda a entidade
âŒ Processamento sÃ­ncrono de eventos

DEBUGGING E TROUBLESHOOTING:
---------------------------

ğŸ” Use CorrelationId para rastrear fluxos
ğŸ” Monitore timestamps para latÃªncia
ğŸ” Valide eventos com IsValid() antes de dispatch
ğŸ” Use ToString() em logs estruturados
ğŸ” Analise Metadata para contexto adicional
ğŸ” Verifique handlers registrados no DI

VERSIONAMENTO:
-------------

ğŸ“‹ VersÃ£o: 2.0.0
ğŸ“‹ Ãšltima AtualizaÃ§Ã£o: 2024
ğŸ“‹ Compatibilidade: .NET 8+ / MediatR 12+
ğŸ“‹ Status: ProduÃ§Ã£o

AUTOR & RESPONSÃVEL:
-------------------

ğŸ‘¨â€ğŸ’» Desenvolvido por: Equipe AuthTenant
ğŸ‘¨â€ğŸ’» Mantido por: Time de Architecture
ğŸ“§ Contato: architecture@AuthTenant.com

=========================================================
