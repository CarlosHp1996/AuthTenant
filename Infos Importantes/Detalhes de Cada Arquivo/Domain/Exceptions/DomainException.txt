=========================================================
DOMAINEXCEPTION.CS - DOCUMENTAÃ‡ÃƒO TÃ‰CNICA
=========================================================

VISÃƒO GERAL:
-----------
Classe base abstrata para todas as exceÃ§Ãµes de domÃ­nio no sistema AuthTenant.
Representa violaÃ§Ãµes de regras de negÃ³cio, invariantes de domÃ­nio e estados invÃ¡lidos.
Fornece funcionalidades avanÃ§adas de contextualizaÃ§Ã£o, auditoria e diagnÃ³stico.

LOCALIZAÃ‡ÃƒO:
-----------
ğŸ“ AuthTenant.Domain/Exceptions/DomainException.cs

DEPENDÃŠNCIAS:
------------
âœ… System.ComponentModel.DataAnnotations - ValidaÃ§Ãµes de dados
âœ… System.Text.Json - SerializaÃ§Ã£o JSON
âœ… System.Exception - HeranÃ§a de exceÃ§Ã£o base
âœ… Dictionary<string, object> - Propriedades extensÃ­veis

RESPONSABILIDADES:
-----------------
ğŸ”¸ Base para todas as exceÃ§Ãµes especÃ­ficas de domÃ­nio
ğŸ”¸ ContextualizaÃ§Ã£o rica de erros com metadados
ğŸ”¸ Auditoria e rastreamento de exceÃ§Ãµes
ğŸ”¸ SerializaÃ§Ã£o estruturada para logging
ğŸ”¸ CorrelaÃ§Ã£o de erros em sistemas distribuÃ­dos
ğŸ”¸ CategorizaÃ§Ã£o e priorizaÃ§Ã£o de severidade

PROPRIEDADES PRINCIPAIS:
-----------------------

1. IDENTIFICAÃ‡ÃƒO E AUDITORIA:
   âœ… ExceptionId (Guid) - ID Ãºnico para rastreamento
   âœ… OccurredAt (DateTime) - Timestamp UTC da criaÃ§Ã£o
   âœ… ExceptionType (string) - Nome da classe calculado
   âœ… ExceptionNamespace (string) - Namespace da exceÃ§Ã£o
   âœ… Rastreabilidade completa do ciclo de vida

2. CONTEXTO MULTI-TENANT:
   âœ… TenantId (string?) - Identificador do tenant
   âœ… UserId (string?) - UsuÃ¡rio relacionado ao erro
   âœ… Isolamento e auditoria por organizaÃ§Ã£o
   âœ… Compliance com LGPD/GDPR

3. CATEGORIZAÃ‡ÃƒO E SEVERIDADE:
   âœ… ErrorCode (string?) - CÃ³digo especÃ­fico do domÃ­nio
   âœ… Category (string) - Categoria para agrupamento
   âœ… Severity (ExceptionSeverity) - NÃ­vel de severidade
   âœ… PriorizaÃ§Ã£o automÃ¡tica de tratamento

4. CONTEXTO E CORRELAÃ‡ÃƒO:
   âœ… Context (string?) - Dados estruturados em JSON
   âœ… CorrelationId (Guid?) - ID para tracing distribuÃ­do
   âœ… Properties (Dictionary) - Propriedades extensÃ­veis
   âœ… Rastreamento end-to-end

5. CONTROLE DE COMPORTAMENTO:
   âœ… IsRetryable (bool) - Indica se pode tentar novamente
   âœ… ShouldLog (bool) - Controla se deve ser logada
   âœ… PolÃ­ticas de resiliÃªncia e observabilidade

ENUM EXCEPTION SEVERITY:
-----------------------

ğŸŸ¢ **Low (1)** - Erros esperados e controlÃ¡veis
   â€¢ ValidaÃ§Ã£o de entrada
   â€¢ Regras de negÃ³cio simples
   â€¢ Dados nÃ£o encontrados em consultas opcionais

ğŸŸ¡ **Medium (2)** - Erros significativos mas nÃ£o crÃ­ticos
   â€¢ Dados nÃ£o encontrados em operaÃ§Ãµes obrigatÃ³rias
   â€¢ PermissÃµes insuficientes
   â€¢ Falhas em validaÃ§Ãµes complexas

ğŸŸ  **High (3)** - Erros que afetam funcionalidades importantes
   â€¢ Falhas em integraÃ§Ãµes externas
   â€¢ InconsistÃªncias de dados
   â€¢ Violations de invariantes de domÃ­nio

ğŸ”´ **Critical (4)** - Erros que comprometem o sistema
   â€¢ CorrupÃ§Ã£o de dados
   â€¢ Falhas de seguranÃ§a
   â€¢ Estados irrecuperÃ¡veis

CONSTRUTORES DISPONÃVEIS:
------------------------

ğŸ”§ **Construtor BÃ¡sico:**
   ```csharp
   protected DomainException(string message, string? tenantId, string? userId, string? errorCode)
   ```
   - Para exceÃ§Ãµes simples com contexto mÃ­nimo
   - Severidade Medium por padrÃ£o
   - Categoria "Domain" por padrÃ£o

ğŸ”§ **Construtor com Inner Exception:**
   ```csharp
   protected DomainException(string message, Exception innerException, ...)
   ```
   - Para wrapping de exceÃ§Ãµes externas
   - Preserva stack trace original
   - Contexto de exceÃ§Ã£o causadora

ğŸ”§ **Construtor Completo:**
   ```csharp
   protected DomainException(message, tenantId, userId, errorCode, category, severity, context, correlationId, isRetryable, shouldLog, innerException)
   ```
   - Controle total sobre todas as propriedades
   - Para cenÃ¡rios avanÃ§ados
   - MÃ¡xima flexibilidade

MÃ‰TODOS FLUENT API:
------------------

ğŸ”§ **WithProperty(key, value)**
   - Adiciona propriedades personalizadas
   - Retorna a prÃ³pria instÃ¢ncia (fluent)
   - Extensibilidade sem quebrar contratos

ğŸ”§ **WithContext(contextData)**
   - Adiciona contexto estruturado via objeto
   - SerializaÃ§Ã£o automÃ¡tica para JSON
   - Combina com contexto existente

ğŸ”§ **WithCorrelationId(correlationId)**
   - Define ID de correlaÃ§Ã£o
   - Rastreamento distribuÃ­do
   - Debugging de fluxos complexos

FUNCIONALIDADES DE SERIALIZAÃ‡ÃƒO:
-------------------------------

ğŸ”§ **ToJson()**
   - SerializaÃ§Ã£o completa para JSON
   - Inclui todas as propriedades relevantes
   - Stack trace limitado (10 linhas)
   - Formato estruturado para logging

ğŸ”§ **ToString() Override**
   - RepresentaÃ§Ã£o legÃ­vel para humanos
   - InformaÃ§Ãµes essenciais em uma linha
   - SeparaÃ§Ã£o clara de campos
   - Inclui inner exception se presente

ğŸ”§ **CombineJsonContext(existing, additional)**
   - Combina objetos JSON de contexto
   - Merge inteligente de propriedades
   - Fallback para concatenaÃ§Ã£o simples
   - Tolerante a falhas de parsing

VALIDAÃ‡Ã•ES DE DADOS:
-------------------

ğŸ“‹ **AnotaÃ§Ãµes de ValidaÃ§Ã£o:**
   - TenantId: StringLength(50)
   - UserId: StringLength(50)
   - ErrorCode: StringLength(20)
   - Category: StringLength(50)
   - Context: StringLength(2000)

ğŸ“‹ **ValidaÃ§Ãµes de NegÃ³cio:**
   - ExceptionId sempre Ãºnico (Guid.NewGuid())
   - OccurredAt sempre UTC
   - Category padrÃ£o "Domain" se nÃ£o especificada
   - Severity padrÃ£o Medium se nÃ£o especificada

PADRÃ•ES ARQUITETURAIS:
---------------------
ğŸ—ï¸ **Abstract Factory** - Base para exceÃ§Ãµes especÃ­ficas
ğŸ—ï¸ **Builder Pattern** - ConstruÃ§Ã£o fluent com mÃ©todos With*
ğŸ—ï¸ **Strategy Pattern** - Diferentes tipos de serializaÃ§Ã£o
ğŸ—ï¸ **Template Method** - Estrutura comum, detalhes especÃ­ficos
ğŸ—ï¸ **Observer Pattern** - NotificaÃ§Ã£o via logging
ğŸ—ï¸ **Composite Pattern** - Propriedades e contexto estruturados

INTEGRAÃ‡ÃƒO COM SISTEMA:
----------------------
ğŸ”— **Logging Framework** - SerializaÃ§Ã£o estruturada
ğŸ”— **Monitoring Tools** - MÃ©tricas por severidade e categoria
ğŸ”— **APM Solutions** - Tracing via CorrelationId
ğŸ”— **Error Tracking** - Agrupamento por ErrorCode
ğŸ”— **Alerting Systems** - EscalaÃ§Ã£o baseada em Severity
ğŸ”— **Audit Systems** - Rastreamento completo

CENÃRIOS DE USO:
---------------
âœ… **ValidaÃ§Ã£o de DomÃ­nio** - Regras de negÃ³cio violadas
âœ… **Estados InvÃ¡lidos** - Invariantes quebradas
âœ… **Recursos NÃ£o Encontrados** - Entidades inexistentes
âœ… **PermissÃµes Insuficientes** - Acesso negado
âœ… **IntegraÃ§Ãµes Falhadas** - ServiÃ§os externos indisponÃ­veis
âœ… **Dados Corrompidos** - InconsistÃªncias detectadas

EXEMPLO DE IMPLEMENTAÃ‡ÃƒO:
------------------------
```csharp
public class ProductNotFoun
dException : DomainException
{
    public string ProductId { get; }
    
    public ProductNotFoundException(string productId, string? tenantId = null)
        : base(
            message: $"Produto com ID '{productId}' nÃ£o foi encontrado",
            tenantId: tenantId,
            errorCode: "PRODUCT_NOT_FOUND",
            category: "NotFound",
            severity: ExceptionSeverity.Medium)
    {
        ProductId = productId;
        
        this.WithContext(new { 
            ProductId = productId,
            SearchContext = "ById",
            PossibleCauses = new[] { 
                "ID invÃ¡lido", 
                "Produto removido", 
                "PermissÃµes insuficientes" 
            }
        });
    }
}
```

EXEMPLO DE USO:
--------------
```csharp
// Uso bÃ¡sico
throw new ProductNotFoundException("PROD-123", "tenant-456");

// Uso com contexto rico
throw new ProductNotFoundException("PROD-123", "tenant-456")
    .WithProperty("SearchMethod", "ByCode")
    .WithProperty("UserRole", "Customer")
    .WithCorrelationId(correlationId)
    .WithContext(new {
        SearchFilters = filters,
        QueryParameters = parameters,
        Performance = new { 
            QueryTime = elapsed,
            CacheHit = false 
        }
    });

// Captura e logging
try
{
    // operaÃ§Ã£o que pode falhar
}
catch (DomainException ex)
{
    logger.LogError(ex.ToJson());
    
    if (ex.IsRetryable)
    {
        // implementar retry
    }
    
    if (ex.Severity == ExceptionSeverity.Critical)
    {
        // notificar equipe
    }
}
```

FUNCIONALIDADES DE OBSERVABILIDADE:
----------------------------------
ğŸ“Š **MÃ©tricas AutomÃ¡ticas:**
   - Contagem por tipo de exceÃ§Ã£o
   - DistribuiÃ§Ã£o por severidade
   - Taxa de exceÃ§Ãµes por tenant
   - Performance de resoluÃ§Ã£o

ğŸ“Š **Alertas ConfigurÃ¡veis:**
   - Threshold por severidade
   - Spike detection
   - PadrÃµes anÃ´malos
   - SLA violations

ğŸ“Š **Dashboards:**
   - Health overview por domÃ­nio
   - Top errors por categoria
   - Trends temporais
   - Correlation analysis

EXTENSIBILIDADE:
---------------
ğŸ”® **Propriedades Customizadas** - Via Properties dictionary
ğŸ”® **Contexto Estruturado** - Via Context JSON
ğŸ”® **Metadados DinÃ¢micos** - Runtime information
ğŸ”® **Hooks de SerializaÃ§Ã£o** - Custom formatters
ğŸ”® **Pipelines de Processamento** - Error handling chains
ğŸ”® **IntegraÃ§Ã£o com APM** - Custom providers

PERFORMANCE:
-----------
âš¡ Lazy evaluation de propriedades computadas
âš¡ JSON serialization otimizada
âš¡ Stack trace truncation para reduzir overhead
âš¡ Dictionary pooling para Properties
âš¡ String interning para categorias comuns

MANUTENÃ‡ÃƒO:
----------
ğŸ”§ Versionamento de schema via Version property
ğŸ”§ Backward compatibility garantida
ğŸ”§ Migration guides para breaking changes
ğŸ”§ Automated testing de serializaÃ§Ã£o
ğŸ”§ Contract validation em CI/CD

CONSIDERAÃ‡Ã•ES DE SEGURANÃ‡A:
--------------------------
ğŸ”’ **SanitizaÃ§Ã£o de Dados** - PrevenÃ§Ã£o de information leakage
ğŸ”’ **PII Protection** - Masking de dados sensÃ­veis
ğŸ”’ **Audit Trail** - Rastreamento completo
ğŸ”’ **Access Control** - Logs baseados em permissÃµes
ğŸ”’ **Compliance** - LGPD/GDPR ready
ğŸ”’ **Rate Limiting** - PrevenÃ§Ã£o de spam de erros

CONSIDERAÃ‡Ã•ES DE COMPLIANCE:
---------------------------
âš ï¸ **LGPD/GDPR** - AnonymizaÃ§Ã£o de dados pessoais
âš ï¸ **SOX** - Auditoria financeira
âš ï¸ **HIPAA** - ProteÃ§Ã£o de dados de saÃºde
âš ï¸ **PCI-DSS** - SeguranÃ§a de dados de pagamento
âš ï¸ **ISO 27001** - GestÃ£o de seguranÃ§a da informaÃ§Ã£o
âš ï¸ **SOC 2** - Controles organizacionais

MÃ‰TRICAS DE QUALIDADE:
---------------------
ğŸ“ˆ **Error Rate** - Percentual de operaÃ§Ãµes com erro
ğŸ“ˆ **MTTR** - Mean Time To Resolution
ğŸ“ˆ **Error Distribution** - Por categoria e severidade
ğŸ“ˆ **Tenant Isolation** - Vazamento de dados entre tenants
ğŸ“ˆ **Performance Impact** - Overhead de exception handling
ğŸ“ˆ **Coverage** - Cobertura de cenÃ¡rios de erro

VERSIONAMENTO:
-------------
ğŸ“‹ VersÃ£o: 2.0.0
ğŸ“‹ Ãšltima AtualizaÃ§Ã£o: 2024
ğŸ“‹ Compatibilidade: .NET 8+
ğŸ“‹ Breaking Changes: Sim (v1 â†’ v2)
ğŸ“‹ Migration Path: DisponÃ­vel
ğŸ“‹ Status: ProduÃ§Ã£o

AUTOR & RESPONSÃVEL:
-------------------
ğŸ‘¨â€ğŸ’» Desenvolvido por: Equipe AuthTenant
ğŸ‘¨â€ğŸ’» Mantido por: Time de Platform
ğŸ“§ Contato: platform@AuthTenant.com
ğŸ”— DocumentaÃ§Ã£o: docs.AuthTenant.com/exceptions

=========================================================
