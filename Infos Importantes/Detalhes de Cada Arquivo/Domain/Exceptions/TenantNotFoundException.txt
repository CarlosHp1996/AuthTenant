=========================================================
TENANTNOTFOUNDEXCEPTION.CS - DOCUMENTAÃ‡ÃƒO TÃ‰CNICA
=========================================================

VISÃƒO GERAL:
-----------
ExceÃ§Ã£o especializada lanÃ§ada quando um tenant solicitado nÃ£o Ã© encontrado no sistema.
Indica identificadores invÃ¡lidos, tenants removidos ou problemas de acesso.
Fornece contexto rico para diferentes tipos de busca e diagnÃ³stico avanÃ§ado.

LOCALIZAÃ‡ÃƒO:
-----------
ğŸ“ AuthTenant.Domain/Exceptions/TenantNotFoundException.cs

DEPENDÃŠNCIAS:
------------
âœ… DomainException - HeranÃ§a de funcionalidades base
âœ… System.ComponentModel.DataAnnotations - ValidaÃ§Ãµes de dados
âœ… ExceptionSeverity - Enum de severidade
âœ… ArgumentException - ValidaÃ§Ãµes de parÃ¢metros

RESPONSABILIDADES:
-----------------
ğŸ”¸ Representar falhas na localizaÃ§Ã£o de tenants
ğŸ”¸ Diagnosticar diferentes cenÃ¡rios de falha
ğŸ”¸ Fornecer contexto para debugging e auditoria
ğŸ”¸ Sugerir possÃ­veis causas e soluÃ§Ãµes
ğŸ”¸ Categorizar tipos de busca realizados
ğŸ”¸ Detectar tenants removidos vs inexistentes

PROPRIEDADES ESPECÃFICAS:
------------------------

1. IDENTIFICAÃ‡ÃƒO DO TENANT:
   âœ… RequestedTenantId (string) - ID que foi solicitado
   âœ… SearchType (string) - Tipo de busca realizada
   âœ… SearchValue (string?) - Valor usado na busca
   âœ… Rastreamento completo da tentativa

2. CONTEXTO DE BUSCA:
   âœ… MayBeDeleted (bool) - Indica possÃ­vel remoÃ§Ã£o
   âœ… LastCheckedAt (DateTime?) - Ãšltima verificaÃ§Ã£o
   âœ… HistÃ³rico de verificaÃ§Ãµes
   âœ… Cache invalidation context

3. DIAGNÃ“STICO AVANÃ‡ADO:
   âœ… PossibleCauses (List<string>) - Causas provÃ¡veis
   âœ… SearchContext - Contexto da operaÃ§Ã£o
   âœ… Performance metrics
   âœ… Recovery suggestions

TIPOS DE BUSCA SUPORTADOS:
-------------------------

ğŸ” **ById** - Busca por identificador Ãºnico
   â€¢ Mais comum e direto
   â€¢ Cache lookup otimizado
   â€¢ ValidaÃ§Ã£o de formato UUID

ğŸ” **ByName** - Busca por nome do tenant
   â€¢ Case-insensitive search
   â€¢ Fuzzy matching disponÃ­vel
   â€¢ HistÃ³rico de renomeaÃ§Ãµes

ğŸ” **ByDomain** - Busca por domÃ­nio customizado
   â€¢ DNS resolution validation
   â€¢ HTTPS certificate check
   â€¢ Subdomain wildcards

ğŸ” **BySubdomain** - Busca por subdomÃ­nio
   â€¢ URL pattern matching
   â€¢ Multi-region support
   â€¢ CDN integration

CONSTRUTORES DISPONÃVEIS:
------------------------

ğŸ”§ **Construtor por ID (Principal):**
   ```csharp
   TenantNotFoundException(string tenantId, string? userId, bool mayBeDeleted, Guid? correlationId)
   ```
   - Para buscas por ID (cenÃ¡rio mais comum)
   - ValidaÃ§Ã£o automÃ¡tica de tenantId
   - Context mÃ­nimo para performance

ğŸ”§ **Construtor AvanÃ§ado:**
   ```csharp
   TenantNotFoundException(string searchValue, string searchType, string? tenantId, string? userId, bool mayBeDeleted, DateTime? lastCheckedAt, Guid? correlationId)
   ```
   - Para diferentes tipos de busca
   - Contexto rico com diagnÃ³stico
   - PossÃ­veis causas automÃ¡ticas

FACTORY METHODS:
---------------

ğŸ­ **ForId(tenantId, userId)**
   - MÃ©todo estÃ¡tico para busca por ID
   - Sintaxe limpa e clara
   - ParÃ¢metros nomeados explÃ­citos

ğŸ­ **ForName(tenantName, userId)**
   - Para buscas por nome
   - SearchType = "ByName" automÃ¡tico
   - Contexto apropriado

ğŸ­ **ForDomain(domain, userId)**
   - Para buscas por domÃ­nio
   - ValidaÃ§Ãµes DNS especÃ­ficas
   - Troubleshooting de configuraÃ§Ã£o

ğŸ­ **ForDeletedTenant(tenantId, userId, lastCheckedAt)**
   - Para tenants removidos
   - MayBeDeleted = true automÃ¡tico
   - Contexto de auditoria

DIAGNÃ“STICO AUTOMÃTICO:
----------------------

ğŸ” **GetPossibleCauses(searchType, mayBeDeleted)**
   - Gera lista de causas provÃ¡veis baseada no contexto
   - EspecÃ­fico para cada tipo de busca
   - Inclui sugestÃµes de resoluÃ§Ã£o

ğŸ“‹ **Causas por Tipo de Busca:**

**ById:**
- ID do tenant invÃ¡lido ou inexistente
- Erro de digitaÃ§Ã£o no identificador
- Tenant removido ou desativado
- PermissÃµes insuficientes
- Cache desatualizado

**ByName:**
- Nome do tenant incorreto
- Tenant renomeado recentemente
- Case sensitivity issues
- Caracteres especiais nÃ£o tratados

**ByDomain:**
- DomÃ­nio customizado nÃ£o configurado
- DNS nÃ£o resolvido corretamente
- SSL certificate issues
- CDN configuration problems

**BySubdomain:**
- SubdomÃ­nio nÃ£o configurado
- URL de acesso incorreta
- Multi-region routing issues
- Load balancer configuration

CONTEXTO ESTRUTURADO:
--------------------

ğŸ—‚ï¸ **Contexto AutomÃ¡tico (WithContext):**
   ```json
   {
     "requestedTenantId": "tenant-123",
     "searchType": "ById",
     "searchValue": "tenant-123",
     "mayBeDeleted": false,
     "lastCheckedAt": "2024-01-15T10:30:00Z",
     "possibleCauses": [
       "ID do tenant invÃ¡lido ou inexistente",
       "Erro de digitaÃ§Ã£o no identificador",
       "PermissÃµes insuficientes para acessar o tenant",
       "Cache desatualizado - tente novamente"
     ]
   }
   ```

FUNCIONALIDADES DE SEGURANÃ‡A:
-----------------------------
ğŸ”’ **Auditoria de Acesso** - Log de tentativas de acesso
ğŸ”’ **Rate Limiting** - PrevenÃ§Ã£o de ataques de enumeraÃ§Ã£o
ğŸ”’ **Masking de Dados** - ProteÃ§Ã£o de informaÃ§Ãµes sensÃ­veis
ğŸ”’ **Correlation Tracking** - Rastreamento de padrÃµes suspeitos
ğŸ”’ **Tenant Isolation** - PrevenÃ§Ã£o de vazamento de dados

CONFIGURAÃ‡Ã•ES DE SEVERIDADE:
---------------------------
ğŸ“Š **Medium (PadrÃ£o)** - Para a maioria dos casos
ğŸ“Š **High** - Para tentativas suspeitas ou repeated failures
ğŸ“Š **Low** - Para buscas opcionais ou exploratÃ³rias
ğŸ“Š **Critical** - Para falhas em operaÃ§Ãµes crÃ­ticas

INTEGRAÃ‡ÃƒO COM SISTEMA:
----------------------
ğŸ”— **Tenant Resolver** - Cache invalidation automÃ¡tico
ğŸ”— **Audit Service** - Logging de tentativas de acesso
ğŸ”— **Monitoring** - Alertas para padrÃµes anÃ´malos
ğŸ”— **DNS Provider** - ValidaÃ§Ã£o de domÃ­nios
ğŸ”— **CDN Service** - VerificaÃ§Ã£o de configuraÃ§Ã£o
ğŸ”— **Security Service** - DetecÃ§Ã£o de ataques

CENÃRIOS DE USO COMUNS:
----------------------
âœ… **Login com Tenant Incorreto** - UsuÃ¡rio digita ID errado
âœ… **MigraÃ§Ã£o de Tenant** - Tenant movido entre regiÃµes
âœ… **ExpiraÃ§Ã£o de Assinatura** - Tenant temporariamente inacessÃ­vel
âœ… **ConfiguraÃ§Ã£o de DNS** - DomÃ­nio customizado mal configurado
âœ… **Ambiente de Desenvolvimento** - Dados de teste inconsistentes
âœ… **Restore de Backup** - Tenant temporariamente indisponÃ­vel

EXEMPLO DE IMPLEMENTAÃ‡ÃƒO:
------------------------
```csharp
// RepositÃ³rio com tratamento avanÃ§ado
public async Task<Tenant> GetByIdAsync(string tenantId, string? userId = null)
{
    try
    {
        var tenant = await _context.Tenants
            .Where(t => t.Id == tenantId && !t.IsDeleted)
            .FirstOrDefaultAsync();
            
        if (tenant == null)
        {
            // Verifica se existe mas foi removido
            var deletedTenant = await _context.Tenants
                .IgnoreQueryFilters()
                .Where(t => t.Id == tenantId && t.IsDeleted)
                .FirstOrDefaultAsync();
                
            if (deletedTenant != null)
            {
                throw TenantNotFoundException.ForDeletedTenant(
                    tenantId, userId, deletedTenant.DeletedAt);
            }
            
            throw TenantNotFoundException.ForId(tenantId, userId);
        }
        
        return tenant;
    }
    catch (FormatException)
    {
        throw new TenantNotFoundException(
            tenantId, "ById", userId: userId)
            .WithContext(new { 
                Error = "Invalid GUID format",
                ProvidedValue = tenantId,
                ExpectedFormat = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
            });
    }
}
```

EXEMPLO DE USO:
--------------
```csharp
// Uso bÃ¡sico
try
{
    var tenant = await tenantService.GetByIdAsync("invalid-id");
}
catch (TenantNotFoundException ex)
{
    // Log estruturado
    logger.LogWarning(ex.ToJson());
    
    // Resposta apropriada para o usuÃ¡rio
    return NotFound(new
    {
        Error = "Tenant nÃ£o encontrado",
        Code = ex.ErrorCode,
        RequestedId = ex.RequestedTenantId,
        SearchType = ex.SearchType,
        Suggestions = GetUserFriendlySuggestions(ex)
    });
}

// Factory methods
throw TenantNotFoundException.ForName("empresa-xyz", userId);
throw TenantNotFoundException.ForDomain("empresa.com", userId);
throw TenantNotFoundException.ForDeletedTenant("tenant-123", userId);

// Com contexto rico
throw TenantNotFoundException.ForId("tenant-123", userId)
    .WithProperty("SearchMethod", "Cache")
    .WithProperty("CacheExpiry", cacheExpiry)
    .WithCorrelationId(correlationId);
```

TROUBLESHOOTING GUIDE:
---------------------

ğŸ”§ **ID InvÃ¡lido:**
   1. Verificar formato GUID
   2. Confirmar tenant existe no ambiente
   3. Validar permissÃµes de acesso
   4. Verificar cache invalidation

ğŸ”§ **Nome Incorreto:**
   1. Verificar case sensitivity
   2. Confirmar caracteres especiais
   3. Verificar histÃ³rico de renomeaÃ§Ãµes
   4. Testar busca fuzzy

ğŸ”§ **DomÃ­nio NÃ£o Funciona:**
   1. Verificar configuraÃ§Ã£o DNS
   2. Testar resoluÃ§Ã£o de nomes
   3. Validar certificado SSL
   4. Confirmar configuraÃ§Ã£o CDN

ğŸ”§ **Tenant Foi Removido:**
   1. Verificar polÃ­ticas de retenÃ§Ã£o
   2. Confirmar processo de restore
   3. Validar backups disponÃ­veis
   4. Checar audit trail

MÃ‰TRICAS E MONITORAMENTO:
------------------------
ğŸ“Š **MÃ©tricas AutomÃ¡ticas:**
   - Taxa de tenant not found por tipo de busca
   - DistribuiÃ§Ã£o de causas mais comuns
   - Performance de lookup por tipo
   - PadrÃµes temporais de falhas

ğŸ“Š **Alertas ConfigurÃ¡veis:**
   - Spike em tentativas de acesso invÃ¡lidas
   - PadrÃµes de enumeraÃ§Ã£o suspeitos
   - DegradaÃ§Ã£o de performance de lookup
   - Falhas em domÃ­nios especÃ­ficos

ğŸ“Š **Dashboards:**
   - Health de resoluÃ§Ã£o de tenants
   - Top tenants nÃ£o encontrados
   - AnÃ¡lise de causas raiz
   - Performance comparison

EXTENSÃ•ES FUTURAS:
-----------------
ğŸ”® **Fuzzy Search** - Busca aproximada por nome
ğŸ”® **Suggestion Engine** - SugestÃµes baseadas em histÃ³rico
ğŸ”® **Auto-correction** - CorreÃ§Ã£o automÃ¡tica de typos
ğŸ”® **Predictive Caching** - Cache inteligente baseado em padrÃµes
ğŸ”® **Multi-language Support** - Mensagens localizadas
ğŸ”® **Integration Testing** - Testes automatizados de cenÃ¡rios

PERFORMANCE:
-----------
âš¡ Lazy evaluation de possible causes
âš¡ Cached validation patterns
âš¡ Optimized string operations
âš¡ Minimal allocations em hot paths
âš¡ Async-friendly design

MANUTENÃ‡ÃƒO:
----------
ğŸ”§ ConfiguraÃ§Ã£o via appsettings para causas customizadas
ğŸ”§ Extensibilidade para novos tipos de busca
ğŸ”§ Logging estruturado para anÃ¡lise
ğŸ”§ Testes automatizados para todos os cenÃ¡rios
ğŸ”§ Documentation atualizada automaticamente

CONSIDERAÃ‡Ã•ES DE SEGURANÃ‡A:
--------------------------
âš ï¸ **Information Disclosure** - NÃ£o vazar informaÃ§Ãµes de tenants existentes
âš ï¸ **Enumeration Attacks** - Rate limiting e detection
âš ï¸ **Timing Attacks** - Consistent response times
âš ï¸ **Audit Trail** - Log completo de tentativas
âš ï¸ **Access Control** - ValidaÃ§Ã£o de permissÃµes
âš ï¸ **Data Masking** - ProteÃ§Ã£o de dados sensÃ­veis

VERSIONAMENTO:
-------------
ğŸ“‹ VersÃ£o: 2.0.0
ğŸ“‹ Ãšltima AtualizaÃ§Ã£o: 2024
ğŸ“‹ Compatibilidade: .NET 8+
ğŸ“‹ Breaking Changes: Sim (Factory methods adicionados)
ğŸ“‹ Migration Path: Backward compatible
ğŸ“‹ Status: ProduÃ§Ã£o

AUTOR & RESPONSÃVEL:
-------------------
ğŸ‘¨â€ğŸ’» Desenvolvido por: Equipe AuthTenant
ğŸ‘¨â€ğŸ’» Mantido por: Time de Platform
ğŸ“§ Contato: platform@AuthTenant.com
ğŸ”— DocumentaÃ§Ã£o: docs.AuthTenant.com/exceptions/tenant-not-found

=========================================================
