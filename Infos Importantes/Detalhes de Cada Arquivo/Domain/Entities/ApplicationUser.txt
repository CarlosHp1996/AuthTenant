=========================================================
APPLICATIONUSER.CS - DOCUMENTAÃ‡ÃƒO TÃ‰CNICA
=========================================================

VISÃƒO GERAL:
-----------
ExtensÃ£o personalizada do IdentityUser do ASP.NET Core para sistema multi-tenant.
Implementa funcionalidades de domÃ­nio para gestÃ£o de usuÃ¡rios, perfis e seguranÃ§a.
Integra autenticaÃ§Ã£o/autorizaÃ§Ã£o com regras de negÃ³cio especÃ­ficas do domÃ­nio.

LOCALIZAÃ‡ÃƒO:
-----------
ğŸ“ AuthTenant.Domain/Entities/ApplicationUser.cs

DEPENDÃŠNCIAS:
------------
âœ… Microsoft.AspNetCore.Identity.IdentityUser - HeranÃ§a de identidade
âœ… System.ComponentModel.DataAnnotations - ValidaÃ§Ãµes de dados
âœ… System.ComponentModel.DataAnnotations.Schema - Mapeamento de banco
âœ… BusinessRuleException - ExceÃ§Ãµes de regras de negÃ³cio
âœ… Tenant - NavegaÃ§Ã£o para inquilino

RESPONSABILIDADES:
-----------------
ğŸ”¸ ExtensÃ£o do sistema de identidade padrÃ£o
ğŸ”¸ GestÃ£o de perfis de usuÃ¡rio e informaÃ§Ãµes pessoais
ğŸ”¸ Controle de acesso e permissÃµes multi-tenant
ğŸ”¸ Tracking de atividades e sessÃµes de usuÃ¡rio
ğŸ”¸ GestÃ£o de configuraÃ§Ãµes e preferÃªncias
ğŸ”¸ Auditoria de seguranÃ§a e compliance

PROPRIEDADES PRINCIPAIS:
-----------------------

1. INFORMAÃ‡Ã•ES PESSOAIS:
   âœ… FirstName (string?) - Nome do usuÃ¡rio
   âœ… LastName (string?) - Sobrenome do usuÃ¡rio
   âœ… ProfileImageUrl (string?) - URL da foto de perfil
   âœ… DateOfBirth (DateTime?) - Data de nascimento opcional
   âœ… ValidaÃ§Ãµes de comprimento e formato

2. MULTI-TENANCY:
   âœ… TenantId (string) - Identificador do inquilino (obrigatÃ³rio)
   âœ… Tenant (navegaÃ§Ã£o) - ReferÃªncia para entidade Tenant
   âœ… Isolamento de dados por inquilino
   âœ… Controle de acesso baseado em tenant

3. CONFIGURAÃ‡Ã•ES DE CONTA:
   âœ… IsActive (bool) - Status de ativaÃ§Ã£o da conta
   âœ… IsDeleted (bool) - Soft delete para auditoria
   âœ… TimeZone (string?) - Fuso horÃ¡rio preferido
   âœ… Language (string?) - Idioma de interface preferido
   âœ… NotificationPreferences (JSON string) - PreferÃªncias de notificaÃ§Ã£o

4. TRACKING DE ATIVIDADE:
   âœ… LastLoginAt (DateTime?) - Ãšltimo login realizado
   âœ… LoginCount (int) - Contador total de logins
   âœ… FailedLoginAttempts (int) - Tentativas de login falhadas
   âœ… LastFailedLoginAt (DateTime?) - Ãšltimo login falhado
   âœ… IsLockedOut (bool) - Status de bloqueio por seguranÃ§a

5. AUDITORIA PERSONALIZADA:
   âœ… CreatedAt (DateTime) - Data/hora de criaÃ§Ã£o
   âœ… CreatedBy (string?) - UsuÃ¡rio que criou a conta
   âœ… UpdatedAt (DateTime?) - Ãšltima atualizaÃ§Ã£o
   âœ… UpdatedBy (string?) - UsuÃ¡rio que fez a Ãºltima atualizaÃ§Ã£o
   âœ… DeletedAt (DateTime?) - Data/hora de exclusÃ£o (soft delete)
   âœ… DeletedBy (string?) - UsuÃ¡rio que excluiu

PROPRIEDADES COMPUTADAS:
------------------------

ğŸ”§ FullName
   - ConcatenaÃ§Ã£o inteligente de FirstName + LastName
   - Retorna Username se nomes nÃ£o disponÃ­veis
   - FormataÃ§Ã£o consistente

ğŸ”§ DisplayName
   - Nome para exibiÃ§Ã£o em interfaces
   - Prioriza FullName, fallback para Email
   - Sempre retorna valor nÃ£o-nulo

ğŸ”§ Initials
   - Iniciais do usuÃ¡rio para avatares
   - Baseado em FirstName e LastName
   - Fallback para primeiros 2 caracteres do Username

ğŸ”§ Age
   - Idade calculada a partir de DateOfBirth
   - Considera ano bissexto e datas futuras
   - Null se data nÃ£o informada

ğŸ”§ IsAccountLocked
   - Status de bloqueio considerando multiple fatores
   - Combina IsLockedOut, IsActive e IsDeleted
   - LÃ³gica centralizada de acesso

ğŸ”§ AccountStatus
   - Status descritivo para interfaces
   - Estados: Active, Inactive, Locked, Deleted, Pending Confirmation

ğŸ”§ DaysSinceLastLogin
   - Dias desde Ãºltimo login para mÃ©tricas
   - Ãštil para identificar usuÃ¡rios inativos
   - Null se nunca fez login

MÃ‰TODOS DE DOMÃNIO - GESTÃƒO DE CONTA:
------------------------------------

ğŸ”§ Activate(string? activatedBy)
   - AtivaÃ§Ã£o segura de conta de usuÃ¡rio
   - ValidaÃ§Ã£o de estado antes da ativaÃ§Ã£o
   - Auditoria automÃ¡tica de mudanÃ§as
   - Reset de contadores de falha

ğŸ”§ Deactivate(string? deactivatedBy)
   - DesativaÃ§Ã£o controlada de conta
   - ManutenÃ§Ã£o de dados para auditoria
   - PrevenÃ§Ã£o de login sem exclusÃ£o
   - Registro de responsÃ¡vel pela aÃ§Ã£o

ğŸ”§ MarkAsDeleted(string? deletedBy)
   - Soft delete com preservaÃ§Ã£o de dados
   - InvalidaÃ§Ã£o imediata de sessÃµes
   - Auditoria completa da exclusÃ£o
   - ManutenÃ§Ã£o de integridade referencial

MÃ‰TODOS DE DOMÃNIO - SEGURANÃ‡A:
------------------------------

ğŸ”§ RecordSuccessfulLogin()
   - Registro de login bem-sucedido
   - Reset de contadores de falha
   - AtualizaÃ§Ã£o de timestamp de Ãºltimo acesso
   - Incremento de estatÃ­sticas de uso

ğŸ”§ RecordFailedLoginAttempt()
   - Tracking de tentativas de login falhadas
   - Incremento de contador de falhas
   - Timestamp de Ãºltima tentativa falhada
   - Base para implementaÃ§Ã£o de rate limiting

ğŸ”§ LockAccount(string? lockedBy)
   - Bloqueio manual ou automÃ¡tico de conta
   - PrevenÃ§Ã£o de acesso atÃ© desbloqueio
   - Auditoria de motivo do bloqueio
   - IntegraÃ§Ã£o com sistema de seguranÃ§a

ğŸ”§ UnlockAccount(string? unlockedBy)
   - Desbloqueio controlado de conta
   - Reset de contadores de falha
   - ValidaÃ§Ã£o de permissÃµes para desbloqueio
   - Auditoria de liberaÃ§Ã£o de acesso

MÃ‰TODOS DE DOMÃNIO - PERFIL:
---------------------------

ğŸ”§ UpdateProfile(string? firstName, string? lastName, DateTime? dateOfBirth, string? updatedBy)
   - AtualizaÃ§Ã£o segura de informaÃ§Ãµes pessoais
   - ValidaÃ§Ã£o de dados de entrada
   - PreservaÃ§Ã£o de histÃ³rico via auditoria
   - Controle de permissÃµes de ediÃ§Ã£o

ğŸ”§ UpdateProfileImage(string? imageUrl, string? updatedBy)
   - GestÃ£o de foto de perfil
   - ValidaÃ§Ã£o de URL e formato
   - Limpeza de referÃªncias antigas
   - IntegraÃ§Ã£o com storage de imagens

ğŸ”§ UpdatePreferences(string? timeZone, string? language, string? notificationPrefs, string? updatedBy)
   - ConfiguraÃ§Ã£o de preferÃªncias pessoais
   - ValidaÃ§Ã£o de valores permitidos
   - AplicaÃ§Ã£o imediata de configuraÃ§Ãµes
   - Suporte a localizaÃ§Ã£o

ğŸ”§ ChangeTenant(string newTenantId, string? changedBy)
   - MigraÃ§Ã£o segura entre inquilinos
   - ValidaÃ§Ã£o de permissÃµes de acesso
   - Limpeza de dados especÃ­ficos do tenant anterior
   - Auditoria de mudanÃ§a de contexto

VALIDAÃ‡Ã•ES DE NEGÃ“CIO:
---------------------

1. INFORMAÃ‡Ã•ES PESSOAIS:
   âŒ FirstName/LastName: 1-100 caracteres se fornecidos
   âŒ Apenas letras, espaÃ§os, hÃ­fens e apostrofes
   âŒ NÃ£o podem ser apenas espaÃ§os em branco
   âŒ ProfileImageUrl deve ser URL vÃ¡lida se fornecida

2. MULTI-TENANCY:
   âŒ TenantId obrigatÃ³rio e nÃ£o-vazio
   âŒ Formato GUID vÃ¡lido
   âŒ Tenant deve existir no sistema
   âŒ UsuÃ¡rio deve ter permissÃ£o de acesso ao tenant

3. CONFIGURAÃ‡Ã•ES:
   âŒ TimeZone deve ser vÃ¡lido (se fornecido)
   âŒ Language deve seguir padrÃ£o ISO (ex: pt-BR, en-US)
   âŒ NotificationPreferences deve ser JSON vÃ¡lido
   âŒ ConfiguraÃ§Ãµes dentro de limites permitidos

4. SEGURANÃ‡A:
   âŒ FailedLoginAttempts nÃ£o pode ser negativo
   âŒ LoginCount nÃ£o pode ser negativo
   âŒ Datas de auditoria devem ser coerentes
   âŒ IsActive nÃ£o pode ser true se IsDeleted for true

CONSTANTES DE VALIDAÃ‡ÃƒO:
-----------------------
ğŸ“Š MAX_NAME_LENGTH = 100 caracteres
ğŸ“Š MAX_URL_LENGTH = 500 caracteres
ğŸ“Š MAX_TIMEZONE_LENGTH = 50 caracteres
ğŸ“Š MAX_LANGUAGE_LENGTH = 10 caracteres
ğŸ“Š MAX_NOTIFICATION_PREFS_LENGTH = 2000 caracteres
ğŸ“Š MAX_FAILED_ATTEMPTS = 10 (sugestÃ£o para rate limiting)
ğŸ“Š MAX_AGE = 150 anos (validaÃ§Ã£o de sanidade)

FUNCIONALIDADES DE SEGURANÃ‡A:
-----------------------------
ğŸ”’ Soft delete para preservaÃ§Ã£o de auditoria
ğŸ”’ Tracking de tentativas de login falhadas
ğŸ”’ Bloqueio automÃ¡tico por seguranÃ§a
ğŸ”’ ValidaÃ§Ã£o de integridade de dados
ğŸ”’ ProteÃ§Ã£o contra ataques de enumeraÃ§Ã£o
ğŸ”’ Auditoria completa de mudanÃ§as

PADRÃ•ES ARQUITETURAIS:
---------------------
ğŸ—ï¸ Active Record Pattern - Entidade com comportamentos
ğŸ—ï¸ Strategy Pattern - Diferentes tipos de usuÃ¡rio
ğŸ—ï¸ Observer Pattern - NotificaÃ§Ãµes de mudanÃ§as
ğŸ—ï¸ Template Method - ValidaÃ§Ãµes personalizÃ¡veis
ğŸ—ï¸ Factory Pattern - CriaÃ§Ã£o controlada
ğŸ—ï¸ Repository Pattern - PersistÃªncia abstraÃ­da

INTEGRAÃ‡ÃƒO COM SISTEMA:
----------------------
ğŸ”— ASP.NET Core Identity - Sistema de autenticaÃ§Ã£o
ğŸ”— Entity Framework - Mapeamento ORM
ğŸ”— JWT Token Service - GeraÃ§Ã£o de tokens
ğŸ”— Email Service - NotificaÃ§Ãµes e confirmaÃ§Ãµes
ğŸ”— Audit Service - Tracking de mudanÃ§as
ğŸ”— Tenant Service - GestÃ£o multi-tenant

CENÃRIOS DE USO:
---------------
âœ… Registro de novos usuÃ¡rios
âœ… Login e autenticaÃ§Ã£o
âœ… GestÃ£o de perfis pessoais
âœ… Controle de acesso multi-tenant
âœ… Tracking de atividades de usuÃ¡rio
âœ… Bloqueio/desbloqueio por seguranÃ§a
âœ… MigraÃ§Ã£o entre inquilinos
âœ… ConfiguraÃ§Ã£o de preferÃªncias

PERFORMANCE:
-----------
âš¡ Propriedades computadas calculadas sob demanda
âš¡ Lazy loading de navegaÃ§Ã£o para Tenant
âš¡ IndexaÃ§Ã£o otimizada (TenantId, Email, IsActive)
âš¡ Consultas otimizadas com filtros eficientes
âš¡ Cache de dados de sessÃ£o

MANUTENÃ‡ÃƒO:
----------
ğŸ”§ Extensibilidade via heranÃ§a de IdentityUser
ğŸ”§ ConfiguraÃ§Ãµes flexÃ­veis via JSON
ğŸ”§ Logs estruturados para debugging
ğŸ”§ MigraÃ§Ã£o de dados simplificada
ğŸ”§ EvoluÃ§Ã£o compatÃ­vel de esquema

CONSIDERAÃ‡Ã•ES DE COMPLIANCE:
---------------------------
âš ï¸ LGPD/GDPR - Direito ao esquecimento
âš ï¸ Consentimento para dados pessoais
âš ï¸ Criptografia de dados sensÃ­veis
âš ï¸ Retention policy para logs
âš ï¸ AnonymizaÃ§Ã£o para analytics
âš ï¸ Audit trail para compliance

EXEMPLO DE USO:
--------------
```csharp
// CriaÃ§Ã£o de usuÃ¡rio
var user = new ApplicationUser
{
    UserName = "usuario@exemplo.com",
    Email = "usuario@exemplo.com",
    TenantId = "tenant-guid",
    FirstName = "JoÃ£o",
    LastName = "Silva",
    CreatedBy = "admin"
};

// ConfiguraÃ§Ã£o de perfil
user.UpdateProfile("JoÃ£o", "Silva Santos", 
    new DateTime(1990, 5, 15), "self");
user.UpdatePreferences("America/Sao_Paulo", "pt-BR", 
    "{\"email\": true, \"sms\": false}", "self");

// GestÃ£o de seguranÃ§a
user.RecordSuccessfulLogin();
if (user.FailedLoginAttempts > 5)
{
    user.LockAccount("security-system");
}

// Analytics
var daysSinceLogin = user.DaysSinceLastLogin;
var isInactive = daysSinceLogin > 30;
var accountStatus = user.AccountStatus;

// ValidaÃ§Ãµes
var isValid = user.IsAccountLocked == false && user.IsActive;
var displayInfo = $"{user.DisplayName} ({user.Initials})";
```

EVENTOS DE DOMÃNIO (FUTURO):
---------------------------
ğŸ”® UserRegistered - Novo usuÃ¡rio registrado
ğŸ”® UserActivated - UsuÃ¡rio ativado
ğŸ”® UserLoggedIn - Login realizado
ğŸ”® UserProfileUpdated - Perfil atualizado
ğŸ”® UserTenantChanged - MudanÃ§a de inquilino
ğŸ”® UserAccountLocked - Conta bloqueada

MÃ‰TRICAS E ANALYTICS:
--------------------
ğŸ“Š Taxa de ativaÃ§Ã£o de usuÃ¡rios
ğŸ“Š FrequÃªncia de login por tenant
ğŸ“Š Tempo mÃ©dio entre logins
ğŸ“Š Tentativas de login falhadas
ğŸ“Š UsuÃ¡rios inativos por perÃ­odo
ğŸ“Š MigraÃ§Ã£o entre tenants

EXTENSÃ•ES FUTURAS:
-----------------
ğŸ”® Two-Factor Authentication - 2FA completo
ğŸ”® Social Login - Login com redes sociais
ğŸ”® Role-Based Access - GestÃ£o de papÃ©is
ğŸ”® Session Management - Controle de sessÃµes
ğŸ”® Password Policy - PolÃ­ticas de senha
ğŸ”® Device Management - GestÃ£o de dispositivos

VERSIONAMENTO:
-------------
ğŸ“‹ VersÃ£o: 2.0.0
ğŸ“‹ Ãšltima AtualizaÃ§Ã£o: 2024
ğŸ“‹ Compatibilidade: .NET 8+ / Identity 8+
ğŸ“‹ Status: ProduÃ§Ã£o

AUTOR & RESPONSÃVEL:
-------------------
ğŸ‘¨â€ğŸ’» Desenvolvido por: Equipe AuthTenant
ğŸ‘¨â€ğŸ’» Mantido por: Time de SeguranÃ§a
ğŸ“§ Contato: security@AuthTenant.com

=========================================================
