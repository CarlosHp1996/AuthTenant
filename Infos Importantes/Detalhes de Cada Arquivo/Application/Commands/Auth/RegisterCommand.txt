# ğŸ“‹ DocumentaÃ§Ã£o: RegisterCommand.cs

## ğŸ¯ **Objetivo**
Record imutÃ¡vel que representa um comando de registro de usuÃ¡rio em ambiente multi-tenant, encapsulando dados pessoais, credenciais e contexto de tenant. Implementa princÃ­pios DDD, Clean Architecture e SOLID.

## ğŸ”§ **Funcionalidades Principais**

### **1. Estrutura DDD (Domain-Driven Design)**
- âœ… **Command Pattern**: Implementa padrÃ£o de comando do CQRS
- âœ… **Value Object**: Record imutÃ¡vel com validaÃ§Ãµes de domÃ­nio
- âœ… **Business Rules**: ValidaÃ§Ãµes especÃ­ficas do domÃ­nio de negÃ³cio
- âœ… **Ubiquitous Language**: Nomenclatura consistente com linguagem do negÃ³cio

### **2. Clean Architecture Compliance**
- âœ… **Camada de Application**: Posicionamento correto na arquitetura
- âœ… **Dependency Direction**: NÃ£o depende de camadas externas
- âœ… **Interface Segregation**: Implementa IRequest especÃ­fico
- âœ… **Single Responsibility**: Foco exclusivo em dados de registro

### **3. SOLID Principles**
- âœ… **Single Responsibility**: Responsabilidade Ãºnica de representar comando de registro
- âœ… **Open/Closed**: ExtensÃ­vel via mÃ©todos adicionais, fechado para modificaÃ§Ã£o
- âœ… **Liskov Substitution**: CompatÃ­vel com IRequest<Result<AuthResponseDto>>
- âœ… **Interface Segregation**: Usa interfaces especÃ­ficas e necessÃ¡rias
- âœ… **Dependency Inversion**: NÃ£o depende de implementaÃ§Ãµes concretas

### **4. ValidaÃ§Ã£o AvanÃ§ada de DomÃ­nio**
- âœ… **Data Annotations**: ValidaÃ§Ã£o automÃ¡tica de entrada
- âœ… **Business Rules Validation**: ValidaÃ§Ãµes especÃ­ficas de negÃ³cio
- âœ… **Password Security Policy**: PolÃ­tica robusta de senhas
- âœ… **Email Domain Validation**: ValidaÃ§Ã£o avanÃ§ada de formato de email
- âœ… **Name Pattern Validation**: ValidaÃ§Ã£o de padrÃµes de nome vÃ¡lidos

### **5. SeguranÃ§a e Compliance**
- âœ… **Password Strength**: Requisitos rigorosos de seguranÃ§a
- âœ… **Data Normalization**: Email normalizado para consistÃªncia
- âœ… **Secure Logging**: ToString() seguro excluindo dados sensÃ­veis
- âœ… **Input Sanitization**: ValidaÃ§Ã£o e limpeza de entrada

## ğŸ—ï¸ **Arquitetura DDD**

### **Domain Model:**
```csharp
public sealed record RegisterCommand : IRequest<Result<AuthResponseDto>>
{
    // Value Objects
    string Email       // Email como identificador Ãºnico
    string Password    // Credencial de autenticaÃ§Ã£o
    string FirstName   // Nome prÃ³prio do usuÃ¡rio
    string LastName    // Sobrenome do usuÃ¡rio
    string TenantId    // Contexto de tenant (agregado)
}
```

### **Domain Properties:**
- `NormalizedEmail`: Email processado para consistÃªncia
- `FullName`: Nome completo derivado
- `UserName`: Username derivado do email

### **Domain Methods:**
- `IsValid()`: ValidaÃ§Ã£o de regras de negÃ³cio
- `GetValidationResult()`: Resultado detalhado de validaÃ§Ã£o
- Domain-specific private validators

## ğŸ“Š **ValidaÃ§Ãµes de DomÃ­nio**

### **Email Business Rules:**
```
âœ… Required: ObrigatÃ³rio para identificaÃ§Ã£o
âœ… EmailAddress: Formato RFC vÃ¡lido
âœ… StringLength: MÃ¡ximo 256 caracteres (padrÃ£o RFC)
âœ… Domain Validation: Estrutura de domÃ­nio vÃ¡lida
âœ… Anti-patterns: NÃ£o pode comeÃ§ar/terminar com ponto
âœ… Normalization: ConversÃ£o para lowercase
```

### **Password Security Policy:**
```
âœ… Required: ObrigatÃ³rio para autenticaÃ§Ã£o
âœ… MinLength: MÃ­nimo 8 caracteres (seguranÃ§a)
âœ… MaxLength: MÃ¡ximo 100 caracteres (performance)
âœ… Complexity: Uppercase + Lowercase + Digit + Special
âœ… Special Characters: @$!%*?& permitidos
âœ… RegEx Validation: PadrÃ£o rigoroso aplicado
```

### **Name Validation Rules:**
```
âœ… Required: Nomes sÃ£o obrigatÃ³rios
âœ… Length: Entre 2 e 50 caracteres
âœ… Character Set: Letras, espaÃ§os, apostrofes, hÃ­fens
âœ… Unicode Support: Suporte a caracteres acentuados
âœ… Anti-patterns: Previne caracteres especiais maliciosos
```

### **Tenant Context Rules:**
```
âœ… Required: Contexto obrigatÃ³rio para multi-tenancy
âœ… Length: MÃ¡ximo 50 caracteres
âœ… Business Rule: Deve existir e estar ativo (validado no handler)
```

## ğŸ”’ **SeguranÃ§a AvanÃ§ada**

### **Password Security:**
```csharp
// PolÃ­tica de senha implementada:
- MÃ­nimo 8 caracteres
- Pelo menos 1 letra maiÃºscula
- Pelo menos 1 letra minÃºscula  
- Pelo menos 1 dÃ­gito
- Pelo menos 1 caractere especial (@$!%*?&)
- ProteÃ§Ã£o contra senhas comuns (futuro)
```

### **Input Validation:**
- Email normalization para consistÃªncia
- Trim de espaÃ§os em nomes
- ValidaÃ§Ã£o de caracteres perigosos
- PrevenÃ§Ã£o de XSS em campos de texto

### **Data Protection:**
```csharp
// ToString() seguro para logs:
"RegisterCommand(Email=user@domain.com, FullName=John Doe, TenantId=tenant-001)"
// Password nunca aparece em logs ou traces
```

## ğŸ® **Uso e IntegraÃ§Ã£o DDD**

### **Command Creation (Application Layer):**
```csharp
var registerCommand = new RegisterCommand(
    Email: "user@example.com",
    Password: "SecurePass123!",
    FirstName: "John",
    LastName: "Doe",
    TenantId: "tenant-001"
);
```

### **Domain Validation:**
```csharp
// Business rules validation
if (!registerCommand.IsValid())
{
    var validationResult = registerCommand.GetValidationResult();
    // Handle domain validation errors
}

// Access normalized data
var normalizedEmail = registerCommand.NormalizedEmail;
var fullName = registerCommand.FullName;
```

### **Integration with Handler:**
```csharp
// Command Ã© processado pelo RegisterHandler
// seguindo princÃ­pios de separaÃ§Ã£o de responsabilidades
var result = await mediator.Send(registerCommand);
```

## ğŸ“ˆ **Domain-Driven Benefits**

### **Ubiquitous Language:**
- Terminologia consistente (Register, Command, Tenant)
- Conceitos de negÃ³cio bem definidos
- ComunicaÃ§Ã£o clara entre desenvolvedores e stakeholders

### **Business Logic Encapsulation:**
- Regras de negÃ³cio no local apropriado
- ValidaÃ§Ãµes especÃ­ficas do domÃ­nio
- ProteÃ§Ã£o da integridade dos dados

### **Clean Architecture Benefits:**
- IndependÃªncia de frameworks
- Testabilidade isolada
- Flexibilidade para mudanÃ§as
- Manutenibilidade aprimorada

## ğŸ§ª **Testabilidade DDD**

### **Unit Testing Scenarios:**
```csharp
// Testes de validaÃ§Ã£o de domÃ­nio
[Fact] ValidEmail_ShouldPass()
[Fact] InvalidEmailFormat_ShouldFail()
[Fact] WeakPassword_ShouldFail()
[Fact] StrongPassword_ShouldPass()
[Fact] InvalidName_ShouldFail()
[Fact] NormalizedEmail_ShouldBeLowercase()
[Fact] FullName_ShouldCombineNames()
[Fact] ValidationResult_ShouldContainSpecificErrors()
```

### **Domain Testing Benefits:**
- Isolamento das regras de negÃ³cio
- Testes rÃ¡pidos sem dependÃªncias
- Cobertura completa de cenÃ¡rios
- ValidaÃ§Ã£o de comportamento de domÃ­nio

## ğŸš€ **Performance e OtimizaÃ§Ã£o**

### **Memory Efficiency:**
- Record structure para eficiÃªncia
- String interning para emails comuns
- Lazy validation com IsValid()
- Minimal object allocation

### **Validation Performance:**
```csharp
// ValidaÃ§Ã£o otimizada com short-circuit
private bool IsEmailValid() => 
    !string.IsNullOrWhiteSpace(Email) &&
    Email.Contains('@') &&
    Email.Length <= 256 &&
    Email.Split('@').Length == 2;
```

## ğŸ“ **ValidationResult Value Object**

### **Design Principles:**
```csharp
public sealed record ValidationResult(bool IsValid, IReadOnlyList<string> Errors);
```

### **Benefits:**
- Immutable result structure
- Type-safe error collection
- Clear success/failure indication
- Detailed error information

## ğŸ“ **Changelog DDD Implementation**

### **VersÃ£o Atual (2.0):**
- âœ… **DDD Implementation**: Command pattern com regras de domÃ­nio
- âœ… **Clean Architecture**: Posicionamento correto na camada Application
- âœ… **SOLID Compliance**: Todos os princÃ­pios implementados
- âœ… **Domain Validation**: ValidaÃ§Ãµes especÃ­ficas de negÃ³cio
- âœ… **Value Objects**: Properties derivadas como NormalizedEmail
- âœ… **Business Logic**: Regras de senha e validaÃ§Ã£o avanÃ§adas
- âœ… **Ubiquitous Language**: Terminologia consistente
- âœ… **Security Policy**: PolÃ­ticas rigorosas implementadas

### **Domain Improvements:**
- Advanced password security policy
- Business-specific email validation
- Name pattern validation with Unicode support
- Tenant context validation
- Comprehensive error reporting
- Secure logging implementation

### **Architectural Benefits:**
- Complete DDD implementation
- Clean Architecture compliance
- SOLID principles adherence
- Enhanced testability
- Improved maintainability
- Domain integrity protection

---
**Data da Ãšltima AtualizaÃ§Ã£o:** 05/09/2025  
**VersÃ£o:** 2.0 (DDD + Clean Architecture + SOLID)  
**Status:** âœ… ProduÃ§Ã£o Ready  
**Architecture:** ğŸ›ï¸ DDD + Clean + SOLID Compliant
