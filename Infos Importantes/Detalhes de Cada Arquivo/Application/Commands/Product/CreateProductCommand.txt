# ğŸ“‹ DocumentaÃ§Ã£o: CreateProductCommand.cs

## ğŸ¯ **Objetivo**
Record imutÃ¡vel que representa um comando de criaÃ§Ã£o de produto no sistema. Encapsula dados de produto, validaÃ§Ãµes de domÃ­nio e regras de negÃ³cio. Implementa princÃ­pios DDD, Clean Architecture e SOLID para gerenciamento de produtos.

## ğŸ”§ **Funcionalidades Principais**

### **1. Domain-Driven Design (DDD)**
- âœ… **Command Pattern**: ImplementaÃ§Ã£o correta do padrÃ£o CQRS
- âœ… **Value Object**: Record imutÃ¡vel com validaÃ§Ãµes de domÃ­nio
- âœ… **Business Rules**: ValidaÃ§Ãµes especÃ­ficas do domÃ­nio de produto
- âœ… **Ubiquitous Language**: Terminologia consistente do e-commerce

### **2. Clean Architecture Compliance**
- âœ… **Application Layer**: Posicionamento correto na arquitetura
- âœ… **Dependency Direction**: NÃ£o depende de camadas externas
- âœ… **Interface Segregation**: Implementa IRequest especÃ­fico
- âœ… **Single Responsibility**: Foco exclusivo em dados de criaÃ§Ã£o de produto

### **3. SOLID Principles**
- âœ… **Single Responsibility**: Responsabilidade Ãºnica de representar comando de produto
- âœ… **Open/Closed**: ExtensÃ­vel via mÃ©todos adicionais, fechado para modificaÃ§Ã£o
- âœ… **Liskov Substitution**: CompatÃ­vel com IRequest<Result<ProductDto>>
- âœ… **Interface Segregation**: Usa interfaces especÃ­ficas e necessÃ¡rias
- âœ… **Dependency Inversion**: NÃ£o depende de implementaÃ§Ãµes concretas

### **4. ValidaÃ§Ã£o AvanÃ§ada de DomÃ­nio**
- âœ… **Data Annotations**: ValidaÃ§Ã£o automÃ¡tica de entrada
- âœ… **Business Rules Validation**: ValidaÃ§Ãµes especÃ­ficas de e-commerce
- âœ… **Price Validation**: Regras rigorosas de preÃ§os
- âœ… **SKU Format Validation**: PadrÃµes de cÃ³digos de produto
- âœ… **Stock Management Rules**: ValidaÃ§Ã£o de estoque

### **5. NormalizaÃ§Ã£o e ConsistÃªncia**
- âœ… **Data Normalization**: Campos normalizados para processamento
- âœ… **SKU Standardization**: SKU em maiÃºsculo para consistÃªncia
- âœ… **Text Trimming**: RemoÃ§Ã£o de espaÃ§os desnecessÃ¡rios
- âœ… **Secure Logging**: ToString() seguro para logs

## ğŸ—ï¸ **Arquitetura DDD**

### **Domain Model:**
```csharp
public sealed record CreateProductCommand : IRequest<Result<ProductDto>>
{
    // Product Identity
    string Name         // Nome do produto (identificador de negÃ³cio)
    string? SKU         // CÃ³digo de produto (identificador Ãºnico)
    
    // Product Information  
    string? Description // DescriÃ§Ã£o detalhada do produto
    decimal Price       // PreÃ§o do produto (valor monetÃ¡rio)
    int StockQuantity   // Quantidade em estoque (gestÃ£o de inventÃ¡rio)
}
```

### **Domain Properties:**
- `NormalizedName`: Nome processado para consistÃªncia
- `NormalizedSKU`: SKU em maiÃºsculo padronizado
- `NormalizedDescription`: DescriÃ§Ã£o sem espaÃ§os extras
- `HasDescription`: Indica se produto tem descriÃ§Ã£o
- `HasSKU`: Indica se produto tem cÃ³digo SKU
- `IsInStock`: Indica se produto tem estoque inicial

### **Domain Methods:**
- `IsValid()`: ValidaÃ§Ã£o de regras de negÃ³cio
- `GetValidationResult()`: Resultado detalhado de validaÃ§Ã£o
- Business-specific private validators

## ğŸ“Š **ValidaÃ§Ãµes de DomÃ­nio**

### **Product Name Business Rules:**
```
âœ… Required: ObrigatÃ³rio para identificaÃ§Ã£o
âœ… Length: Entre 2 e 200 caracteres
âœ… Characters: Letras, nÃºmeros, espaÃ§os, alguns sÃ­mbolos permitidos
âœ… Pattern: Regex para caracteres seguros (@"^[a-zA-Z0-9\s\-_.'""()&/]+$")
âœ… Normalization: Trim de espaÃ§os e validaÃ§Ã£o
```

### **Price Business Rules:**
```
âœ… Required: ObrigatÃ³rio para transaÃ§Ãµes
âœ… Range: Entre 0.01 e 999,999.99
âœ… Precision: MÃ¡ximo 2 casas decimais
âœ… Positive: Deve ser valor positivo
âœ… Business Logic: PrevenÃ§Ã£o de preÃ§os zero ou negativos
```

### **SKU (Stock Keeping Unit) Rules:**
```
âœ… Optional: Pode ser nulo ou vazio
âœ… Length: MÃ¡ximo 50 caracteres
âœ… Format: Apenas letras maiÃºsculas, nÃºmeros, hÃ­fens e underscores
âœ… Pattern: Regex (@"^[A-Z0-9\-_]*$")
âœ… Uniqueness: Validado no handler (regra de negÃ³cio)
```

### **Stock Quantity Rules:**
```
âœ… Required: ObrigatÃ³rio para gestÃ£o de estoque
âœ… Range: NÃ£o-negativo (0 ou maior)
âœ… Business Logic: Zero indica "sem estoque inicial"
âœ… Validation: Suporte a produtos sem estoque inicial
```

### **Description Rules:**
```
âœ… Optional: Pode ser nulo ou vazio
âœ… Length: MÃ¡ximo 1000 caracteres
âœ… Content: Aceita qualquer texto vÃ¡lido
âœ… Normalization: Trim de espaÃ§os desnecessÃ¡rios
```

## ğŸ”’ **ValidaÃ§Ãµes de NegÃ³cio AvanÃ§adas**

### **Price Validation (Domain-Specific):**
```csharp
private bool IsPriceValid()
{
    return Price > 0 &&                    // Positive value
           Price <= 999999.99m &&          // Business limit
           Math.Round(Price, 2) == Price;  // Max 2 decimal places
}
```

### **Name Validation (Business Rules):**
```csharp
private bool IsNameValid()
{
    return !string.IsNullOrWhiteSpace(Name) &&
           Name.Trim().Length >= 2 &&          // Min length
           Name.Length <= 200 &&               // Max length
           !Name.Trim().StartsWith(' ') &&     // No leading spaces
           !Name.Trim().EndsWith(' ');         // No trailing spaces
}
```

### **SKU Format Validation:**
```csharp
private bool IsSKUValid()
{
    if (string.IsNullOrWhiteSpace(SKU))
        return true; // Optional field
        
    var normalizedSKU = SKU.Trim().ToUpperInvariant();
    return normalizedSKU.Length <= 50 &&
           normalizedSKU.All(c => char.IsLetterOrDigit(c) || c == '-' || c == '_');
}
```

## ğŸ® **Uso e IntegraÃ§Ã£o DDD**

### **Command Creation (Application Layer):**
```csharp
var createProductCommand = new CreateProductCommand(
    Name: "Premium Wireless Headphones",
    Description: "High-quality wireless headphones with noise cancellation",
    Price: 299.99m,
    SKU: "PWH-001",
    StockQuantity: 50
);
```

### **Domain Validation:**
```csharp
// Business rules validation
if (!createProductCommand.IsValid())
{
    var validationResult = createProductCommand.GetValidationResult();
    // Handle domain validation errors
}

// Access normalized data
var normalizedName = createProductCommand.NormalizedName;
var normalizedSKU = createProductCommand.NormalizedSKU;
bool hasDescription = createProductCommand.HasDescription;
```

### **Integration with Handler:**
```csharp
// Command Ã© processado pelo CreateProductHandler
// seguindo princÃ­pios de separaÃ§Ã£o de responsabilidades
var result = await mediator.Send(createProductCommand);
```

## ğŸ“ˆ **Domain Properties Benefits**

### **Normalized Properties:**
```csharp
// Original: "  Premium Headphones  "
NormalizedName: "Premium Headphones"

// Original: "  pwh-001  "
NormalizedSKU: "PWH-001"

// Original: "  Great product...  "
NormalizedDescription: "Great product..."
```

### **Business Indicators:**
```csharp
HasDescription: true/false   // Business logic for description requirement
HasSKU: true/false          // Business logic for SKU requirement  
IsInStock: true/false       // Business logic for initial stock status
```

## ğŸ”’ **SeguranÃ§a e Logging**

### **Secure Logging:**
```csharp
// ToString() implementation for safe logging:
"CreateProductCommand(Name=Premium Headphones, Price=$299.99, SKU=PWH-001, Stock=50)"
// NÃ£o expÃµe dados sensÃ­veis, inclui informaÃ§Ãµes de auditoria
```

### **Input Sanitization:**
- Name normalization para consistÃªncia
- SKU uppercase conversion
- Description trimming
- Price precision control

## ğŸ§ª **Testabilidade DDD**

### **Unit Testing Scenarios:**
```csharp
// Testes de validaÃ§Ã£o de domÃ­nio
[Fact] ValidProduct_ShouldPass()
[Fact] InvalidProductName_ShouldFail()
[Fact] NegativePrice_ShouldFail()
[Fact] InvalidSKUFormat_ShouldFail()
[Fact] NegativeStock_ShouldFail()
[Fact] NormalizedSKU_ShouldBeUppercase()
[Fact] NormalizedName_ShouldBeTrimmed()
[Fact] ValidationResult_ShouldContainSpecificErrors()
[Fact] OptionalFields_ShouldHandleNullValues()
```

### **Domain Testing Benefits:**
- Isolamento das regras de negÃ³cio
- Testes rÃ¡pidos sem dependÃªncias
- Cobertura completa de cenÃ¡rios
- ValidaÃ§Ã£o de comportamento de domÃ­nio

## ğŸš€ **Performance e OtimizaÃ§Ã£o**

### **Memory Efficiency:**
- Record structure para eficiÃªncia
- String interning para nomes comuns
- Lazy validation com IsValid()
- Minimal object allocation

### **Validation Performance:**
```csharp
// ValidaÃ§Ã£o otimizada com short-circuit
private bool IsValid() => 
    IsNameValid() &&      // Exit early if name invalid
    IsPriceValid() &&     // Exit early if price invalid
    IsStockQuantityValid() &&
    IsSKUValid() &&
    IsDescriptionValid();
```

## ğŸ“ **ProductValidationResult Value Object**

### **Design Principles:**
```csharp
public sealed record ProductValidationResult(bool IsValid, IReadOnlyList<string> Errors);
```

### **Benefits:**
- Immutable result structure
- Type-safe error collection
- Clear success/failure indication
- Detailed error information for UI

## ğŸ“ˆ **Business Value**

### **E-commerce Domain:**
- Product catalog management
- Inventory control foundation
- Price management rules
- SKU standardization
- Stock tracking preparation

### **Domain Events (Future):**
- ProductCreationRequested
- PriceValidated
- SKUAssigned
- InitialStockSet

## ğŸ“ **Changelog DDD Implementation**

### **VersÃ£o Atual (2.0):**
- âœ… **DDD Implementation**: Command pattern com regras de e-commerce
- âœ… **Clean Architecture**: Posicionamento correto na camada Application
- âœ… **SOLID Compliance**: Todos os princÃ­pios implementados
- âœ… **Domain Validation**: ValidaÃ§Ãµes especÃ­ficas de produto
- âœ… **Value Objects**: Properties derivadas para normalizaÃ§Ã£o
- âœ… **Business Logic**: Regras de preÃ§o, SKU e estoque
- âœ… **Ubiquitous Language**: Terminologia de e-commerce
- âœ… **Security Policy**: ValidaÃ§Ã£o de entrada e logging seguro

### **Product Domain Improvements:**
- Advanced price validation with precision control
- SKU format standardization and validation
- Product name sanitization and validation
- Stock quantity business rules
- Comprehensive error reporting
- Secure logging for audit trail

### **Architectural Benefits:**
- Complete DDD implementation for product domain
- Clean Architecture compliance
- SOLID principles adherence
- Enhanced testability for product logic
- Improved maintainability
- Domain integrity protection

---
**Data da Ãšltima AtualizaÃ§Ã£o:** 05/09/2025  
**VersÃ£o:** 2.0 (DDD + Clean Architecture + SOLID)  
**Status:** âœ… ProduÃ§Ã£o Ready  
**Domain:** ğŸ›ï¸ E-commerce Product Management  
**Architecture:** ğŸ›ï¸ DDD + Clean + SOLID Compliant
