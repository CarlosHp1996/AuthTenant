# ğŸ“‹ DocumentaÃ§Ã£o: LoggingBehavior.cs

## ğŸ¯ **Objetivo**
MediatR pipeline behavior responsÃ¡vel por logging estruturado, mÃ©tricas de performance e observabilidade de requisiÃ§Ãµes.

## ğŸ”§ **Funcionalidades Principais**

### **1. Logging Estruturado**
- âœ… Logs categorizados com emojis visuais (ğŸš€, âœ…, âŒ, âš ï¸)
- âœ… InformaÃ§Ãµes contextuais completas (RequestId, Timestamp, Type)
- âœ… Scopes estruturados para correlaÃ§Ã£o de logs
- âœ… SerializaÃ§Ã£o segura de payloads (desenvolvimento)

### **2. MÃ©tricas de Performance**
- âœ… CategorizaÃ§Ã£o automÃ¡tica: Fast (<100ms), Normal (100ms-1s), Slow (1s-5s), VerySlow (>5s)
- âœ… Alertas automÃ¡ticos para requisiÃ§Ãµes lentas
- âœ… MÃ©tricas detalhadas de duraÃ§Ã£o
- âœ… Thresholds configurÃ¡veis por categoria

### **3. Contexto de ExecuÃ§Ã£o**
- âœ… IdentificaÃ§Ã£o de Commands vs Queries
- âœ… RequestId Ãºnico para rastreamento
- âœ… Namespace e tipo de requisiÃ§Ã£o
- âœ… Timestamp preciso de execuÃ§Ã£o

### **4. Tratamento de ExceÃ§Ãµes**
- âœ… Logging especializado por tipo de exceÃ§Ã£o
- âœ… Context logging para ValidationException (FluentValidation)
- âœ… InformaÃ§Ãµes detalhadas de falhas
- âœ… PreservaÃ§Ã£o do stack trace

### **5. SeguranÃ§a e Compliance**
- âœ… Mascaramento de dados sensÃ­veis em logs
- âœ… Logs condicionais baseados em nÃ­vel (Debug/Production)
- âœ… SanitizaÃ§Ã£o de payloads
- âœ… Controle de verbosidade por ambiente

## ğŸ—ï¸ **Arquitetura**

### **Classes Principais:**
- `LoggingBehavior<TRequest, TResponse>`: Behavior principal
- `RequestExecutionContext`: Contexto de execuÃ§Ã£o
- `RequestPerformanceCategory`: Enum de categorizaÃ§Ã£o
- `DisposableScope`: Scope para logging estruturado

### **DependÃªncias:**
- `MediatR`: Pipeline behavior
- `Microsoft.Extensions.Logging`: Logging estruturado
- `System.Text.Json`: SerializaÃ§Ã£o de payloads

## ğŸ“Š **MÃ©tricas e Performance**

### **Categorias de Performance:**
```
Fast: < 100ms (LogLevel.Information)
Normal: 100ms - 1s (LogLevel.Information)
Slow: 1s - 5s (LogLevel.Warning)
VerySlow: > 5s (LogLevel.Warning)
```

### **Logs Estruturados:**
- Request Start: Nome, ID, Tipo, Timestamp
- Request Success: DuraÃ§Ã£o, Categoria, Response
- Request Failure: Exception, DuraÃ§Ã£o, Context
- Performance Alerts: Requests lentas com thresholds

## ğŸ”’ **SeguranÃ§a**

### **ProteÃ§Ã£o de Dados:**
- Mascaramento automÃ¡tico de campos sensÃ­veis
- Logs de payload apenas em desenvolvimento
- SanitizaÃ§Ã£o de informaÃ§Ãµes crÃ­ticas
- Controle de nÃ­vel por ambiente

### **Campos Protegidos:**
- Passwords, Tokens, API Keys
- Dados pessoais sensÃ­veis
- InformaÃ§Ãµes de autenticaÃ§Ã£o
- Payloads em produÃ§Ã£o

## ğŸ® **ConfiguraÃ§Ã£o**

### **Registro no DI:**
```csharp
services.AddTransient(typeof(IPipelineBehavior<,>), typeof(LoggingBehavior<,>));
```

### **ConfiguraÃ§Ã£o de Logging:**
```json
{
  "Logging": {
    "LogLevel": {
      "AuthTenant.Application.Behaviors.LoggingBehavior": "Debug"
    }
  }
}
```

## ğŸ“ˆ **Monitoramento**

### **MÃ©tricas Coletadas:**
- DuraÃ§Ã£o de requisiÃ§Ãµes
- Taxa de sucesso/falha
- Contadores por tipo de request
- Alertas de performance

### **CorrelaÃ§Ã£o:**
- RequestId Ãºnico por request
- Scopes estruturados
- Timestamps precisos
- Context completo

## ğŸ§ª **Testabilidade**

### **Pontos de Teste:**
- Mock de ILogger para verificar logs
- SimulaÃ§Ã£o de diferentes duraÃ§Ãµes
- Teste de categorizaÃ§Ã£o de performance
- ValidaÃ§Ã£o de context creation

### **CenÃ¡rios de Teste:**
- Requests rÃ¡pidas vs lentas
- ExceÃ§Ãµes de validaÃ§Ã£o
- Falhas inesperadas
- SerializaÃ§Ã£o de payloads

## ğŸš€ **BenefÃ­cios**

### **Observabilidade:**
- Rastreamento completo de requisiÃ§Ãµes
- Debugging facilitado com logs estruturados
- MÃ©tricas automÃ¡ticas de performance
- Alertas proativos para problemas

### **Manutenibilidade:**
- CÃ³digo limpo e bem documentado
- SeparaÃ§Ã£o clara de responsabilidades
- Extensibilidade para novos tipos de log
- ConfiguraÃ§Ã£o flexÃ­vel

### **Performance:**
- Logging assÃ­ncrono
- SerializaÃ§Ã£o condicional
- Scopes otimizados
- Overhead mÃ­nimo

## ğŸ“ **Changelog**

### **VersÃ£o Atual:**
- âœ… RefatoraÃ§Ã£o completa para logging estruturado
- âœ… ImplementaÃ§Ã£o de mÃ©tricas de performance
- âœ… SeguranÃ§a e mascaramento de dados
- âœ… DocumentaÃ§Ã£o XML completa
- âœ… Testes de compatibilidade com FluentValidation

### **Melhorias Implementadas:**
- Performance categorization automÃ¡tica
- Context logging estruturado
- Exception handling especializado
- Security e compliance features
- Observability completa

---
**Data da Ãšltima AtualizaÃ§Ã£o:** 05/09/2025  
**VersÃ£o:** 2.0 (Refatorada)  
**Status:** âœ… ProduÃ§Ã£o Ready
